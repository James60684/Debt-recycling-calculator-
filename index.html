<!DOCTYPE html>
<html lang="en">
<head <!-- iOS app icon -->
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

<!-- Optional larger versions -->
<link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Debt Recycling Calculator (AU)</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Debt Recycling AU">
<meta name="theme-color" content="#ffffff">
<style>
:root{
  --blue:#1f6feb; --green:#1a8d3a; --green-200:#e7f6ec; --green-600:#0a7a28;
  --red:#d12f2f; --red-600:#b00020;
  --ink:#111; --muted:#667; --line:#e3e6eb; --panel:#fff; --bg:#f6f7f9;
  --gap:14px;
}
*{box-sizing:border-box}
html,body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
header{padding:24px 18px 10px}
h1{margin:0 0 6px;font-size:22px}
.muted{color:var(--muted);margin:0;font-size:13px}
main{padding:0 14px 40px}
.card{background:var(--panel);border-radius:14px;padding:16px;margin-bottom:12px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
h2{font-size:16px;margin:0 0 12px}
.row{display:flex;gap:var(--gap);align-items:center;justify-content:space-between;margin:10px 0}
.row input,.row select{width:48%;padding:10px 12px;border:1px solid #d8dde6;border-radius:10px;font-size:16px;background:#fbfcfe}
.switch{gap:10px;justify-content:flex-start}
.note{color:var(--muted);font-size:12px;margin-top:6px}
button{width:100%;padding:12px;font-size:16px;border:none;border-radius:10px;background:var(--blue);color:#fff}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.small{font-size:12px;color:var(--muted)}
.kv{display:flex;justify-content:space-between;align-items:baseline;margin:8px 0}
.kv strong{font-variant-numeric:tabular-nums}
hr{border:0;border-top:1px dashed var(--line);margin:10px 0}
.badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;line-height:1}
.pill-green{background:var(--green-200);color:var(--green-600)}
.pill-grey{background:#eef2ff;color:#334}
.num-good{color:var(--green-600)} .num-bad{color:var(--red-600)}

/* Headlines */
.headlines{display:grid;grid-template-columns:1fr;gap:10px;margin-top:4px}
@media (min-width:560px){ .headlines{grid-template-columns:1fr 1fr 1fr} }
.headline{background:#f0f7ff;border:1px solid #e1efff;border-radius:12px;padding:12px}
.headline h3{margin:0 0 4px;font-size:14px;color:#234}
.big{font-size:20px;font-weight:700;line-height:1.2}
.sectionTitle{margin:8px 0 6px;font-weight:700;font-size:14px;color:#345}
.dim{color:#667}

/* Chart */
.chartWrap{margin-top:12px}
canvas{width:100%; height:240px; display:block; border-radius:10px; background:#fff}
.chartLegend{display:flex; gap:12px; align-items:center; font-size:12px; color:#445; margin-top:6px}
.legendDot{width:10px; height:10px; border-radius:6px; display:inline-block}
.dotRed{background:var(--red)}
.dotGreen{background:var(--green)}

/* Sliders */
.slideRow{display:grid;grid-template-columns:120px 1fr 70px;gap:10px;align-items:center}
input[type=range]{appearance:none;width:100%;height:6px;border-radius:6px;background:#e6ecf4;outline:none}
input[type=range]::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid var(--blue);box-shadow:0 1px 2px rgba(0,0,0,.15)}
.help{font-size:12px;color:var(--muted);margin-top:4px}
</style>
</head>
<body>
<header>
  <h1>Debt Recycling (AU)</h1>
  <p class="muted">Simple model • Not financial advice</p>
</header>

<main>
  <section class="card">
    <h2>Your marginal tax rate</h2>
    <label class="row">
      <span>Australian resident tax brackets (2025–26)</span>
      <select id="taxBracket"></select>
    </label>
    <label class="row switch">
      <input type="checkbox" id="medicare" checked />
      <span>Include Medicare levy (2%)</span>
    </label>
    <p class="note">Brackets exclude the Medicare levy.</p>
  </section>

  <section class="card">
    <h2>Home loan & strategy</h2>
    <div class="grid">
      <label><span class="small">Home loan balance</span><input id="homeLoan" type="number" inputmode="decimal" value="600000"></label>
      <label><span class="small">Home loan rate (%)</span><input id="homeRate" type="number" inputmode="decimal" value="6.5"></label>
      <label><span class="small">Remaining loan term (years)</span><input id="loanTerm" type="number" inputmode="numeric" value="25"></label>
      <label><span class="small">Investment loan rate (%)</span><input id="investRate" type="number" inputmode="decimal" value="6.5"></label>
      <label><span class="small">Initial equity released (A$)</span><input id="equityRelease" type="number" inputmode="decimal" value="0"></label>
      <label><span class="small">Extra repayment (monthly)</span><input id="extraMonthly" type="number" inputmode="decimal" value="1000"></label>
      <label><span class="small">Offset balance (A$)</span><input id="offsetStart" type="number" inputmode="decimal" value="0"></label>
      <label><span class="small">Dividends destination</span>
        <select id="divDest">
          <option value="repay">Extra repayment</option>
          <option value="offset">Offset account</option>
          <option value="reinvest">Reinvest</option>
        </select>
      </label>
    </div>
  </section>

  <section class="card">
    <h2>Investments</h2>
    <div class="grid">
      <label><span class="small">Expected total return p.a. (%)</span><input id="expectedReturn" type="number" inputmode="decimal" value="7"></label>
      <label><span class="small">Dividend yield p.a. (%)</span><input id="divYield" type="number" inputmode="decimal" value="4"></label>
      <label><span class="small">Horizon (years)</span><input id="years" type="number" inputmode="numeric" value="10" min="1" max="40"></label>
    </div>
    <p class="note">Dividends are taxable cash; growth is unrealised (no CGT until sale). Offset reduces interest by the offset balance but doesn’t reduce principal.</p>
    <button id="calcBtn">Calculate</button>
  </section>

  <!-- NEW: What-if sliders -->
  <section class="card">
    <h2>What-if sliders</h2>
    <div class="slideRow">
      <div class="small">Home loan rate</div>
      <input id="s_homeRate" type="range" min="3" max="9" step="0.05" value="6.5">
      <input id="homeRate_view" type="text" value="6.5%" readonly>
    </div>
    <div class="slideRow">
      <div class="small">Investment loan rate</div>
      <input id="s_investRate" type="range" min="3" max="9" step="0.05" value="6.5">
      <input id="investRate_view" type="text" value="6.5%" readonly>
    </div>
    <div class="slideRow">
      <div class="small">Expected return</div>
      <input id="s_expectedReturn" type="range" min="4" max="12" step="0.1" value="7">
      <input id="expectedReturn_view" type="text" value="7.0%" readonly>
    </div>
    <div class="slideRow">
      <div class="small">Dividend yield</div>
      <input id="s_divYield" type="range" min="0" max="8" step="0.1" value="4">
      <input id="divYield_view" type="text" value="4.0%" readonly>
    </div>
    <div class="slideRow">
      <div class="small">Extra repayment</div>
      <input id="s_extraMonthly" type="range" min="0" max="5000" step="50" value="1000">
      <input id="extraMonthly_view" type="text" value="$1,000" readonly>
    </div>
    <div class="help">Move the sliders to test “what-if” scenarios. Values sync with the inputs above and the chart updates when you hit <b>Calculate</b>.</div>
  </section>

  <!-- Results -->
  <section class="card" id="resultsCard" style="display:none">
    <h2>What this means for you</h2>
    <div class="headlines">
      <div class="headline">
        <h3>Loan paid off faster <span id="hl_timeBadge" class="badge pill-green" style="display:none"></span></h3>
        <div class="big" id="hl_timeSaved">—</div>
        <div class="dim">Strategy vs doing nothing extra</div>
      </div>
      <div class="headline">
        <h3>Investments could grow to <span id="hl_portBadge" class="badge pill-grey" style="display:none"></span></h3>
        <div class="big num-good" id="hl_portfolio">—</div>
        <div class="dim">After dividend tax (growth reinvested)</div>
      </div>
      <div class="headline">
        <h3>Interest saved via offset</h3>
        <div class="big num-good" id="hl_offsetSaved">—</div>
        <div class="dim">From your offset balance</div>
      </div>
    </div>

    <div class="chartWrap">
      <canvas id="loanChart" aria-label="Loan balance over time with and without debt recycling" role="img"></canvas>
      <div class="chartLegend">
        <span class="legendDot dotRed"></span> No change (minimum repayments)
        <span style="width:8px"></span>
        <span class="legendDot dotGreen"></span> With debt recycling
        <span id="timeSavedTag" class="dim" style="margin-left:auto;"></span>
      </div>
    </div>

    <div class="sectionTitle">Loan impact</div>
    <div class="kv"><span>Home loan paid off (no strategy)</span><strong id="baselinePayoff">—</strong></div>
    <div class="kv"><span>Home loan paid off (with strategy)</span><strong id="strategyPayoff">—</strong></div>
    <div class="kv"><span>Time saved on the loan</span><strong id="timeSaved">—</strong></div>

    <hr>
    <div class="sectionTitle">Investment growth</div>
    <div class="kv"><span>How much you’ve put in (equity + recycling)</span><strong id="totalInvested">—</strong></div>
    <div class="kv"><span>What your investments could grow to</span><strong id="portfolioValue">—</strong></div>

    <hr>
    <div class="sectionTitle">Tax impact</div>
    <div class="kv"><span>Tax you’ll pay on dividends</span><strong id="divTax">—</strong></div>
    <div class="kv"><span>Interest you can claim as a deduction</span><strong id="loanInterest">—</strong></div>
    <div class="kv"><span><span class="badge pill-grey">Net impact of tax</span> (savings − dividend tax)</span><strong id="netTaxBenefit">—</strong></div>

    <hr>
    <div class="kv"><span>Final offset balance</span><strong id="offsetFinal">—</strong></div>

    <p class="note" id="narrative">—</p>
  </section>
</main>

<script>
// --- Tax brackets (2025–26, excl. Medicare levy)
const TAX_BRACKETS = [
  { label: "0 – $18,200 (0%)", rate: 0.00 },
  { label: "$18,201 – $45,000 (16%)", rate: 0.16 },
  { label: "$45,001 – $135,000 (30%)", rate: 0.30 },
  { label: "$135,001 – $190,000 (37%)", rate: 0.37 },
  { label: "$190,001+ (45%)", rate: 0.45 }
];

function $(id){ return document.getElementById(id); }
function money(x){ return x.toLocaleString("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}); }
function monthsToYearsMonths(m){ const y=Math.floor(m/12), mo=m%12; return `${y}y ${mo}m`; }
function pmt(P,r,n){ if(r===0) return P/n; return P*r/(1-Math.pow(1+r,-n)); }

// Baseline loan series
function seriesBaseline(principal, mRate, standardPmt){
  let bal=principal, out=[bal], m=0;
  while(bal>0 && m<2000*12){
    const interest=bal*mRate;
    const pay=Math.min(standardPmt, bal+interest);
    bal -= (pay - interest);
    out.push(Math.max(bal,0));
    m++;
  }
  return out;
}

// Chart (with shaded time-saved window & headroom)
function drawChart(canvas, redSeries, greenSeries, payoffRed, payoffGreen){
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth, H = canvas.clientHeight;
  canvas.width = Math.floor(W * dpr);
  canvas.height = Math.floor(H * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.clearRect(0,0,W,H);

  const padL = 58, padR = 12, padT = 24, padB = 26;
  const plotW = W - padL - padR, plotH = H - padT - padB;

  const maxLen = Math.max(redSeries.length, greenSeries.length);
  const maxData = Math.max(...redSeries, ...greenSeries);
  const maxY = maxData * 1.06;
  const minY = 0;

  // grid (yearly)
  ctx.strokeStyle = "#eef1f5"; ctx.lineWidth=1;
  for(let m=0;m<maxLen;m+=12){
    const x = padL + (m/(maxLen-1))*plotW;
    ctx.beginPath(); ctx.moveTo(x,padT); ctx.lineTo(x,padT+plotH); ctx.stroke();
  }

  // y labels
  ctx.fillStyle="#445"; ctx.font="12px -apple-system, BlinkMacSystemFont, sans-serif";
  ctx.textAlign="right"; ctx.textBaseline="top"; ctx.fillText(money(maxData), padL-6, padT-2);
  ctx.textBaseline="bottom"; ctx.fillText("$0", padL-6, padT+plotH+2);

  const xFor = i => padL + (i/(maxLen-1))*plotW;
  const yFor = v => padT + plotH - ((v-minY)/(maxY-minY))*plotH;

  ctx.lineCap="round";

  // shaded time-saved window
  if (payoffRed > payoffGreen){
    const xG=xFor(payoffGreen), xR=xFor(payoffRed);
    ctx.fillStyle="rgba(26,141,58,0.08)";
    ctx.fillRect(xG, padT, xR-xG, plotH);
  }

  // red line
  ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--red').trim() || "#d12f2f";
  ctx.lineWidth=2; ctx.beginPath();
  redSeries.forEach((v,i)=>{ const x=xFor(i), y=yFor(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
  ctx.stroke();

  // green line
  ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--green').trim() || "#1a8d3a";
  ctx.lineWidth=2; ctx.beginPath();
  greenSeries.forEach((v,i)=>{ const x=xFor(i), y=yFor(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
  ctx.stroke();

  // time-saved markers + label
  const tag = $("timeSavedTag");
  if (payoffRed > payoffGreen){
    const xR = xFor(payoffRed), xG = xFor(payoffGreen);
    const midY = padT + plotH - 6;
    ctx.strokeStyle="#999"; ctx.setLineDash([4,4]);
    ctx.beginPath(); ctx.moveTo(xR,padT); ctx.lineTo(xR,padT+plotH); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(xG,padT); ctx.lineTo(xG,padT+plotH); ctx.stroke();
    ctx.setLineDash([]);

    ctx.strokeStyle="#555"; ctx.beginPath(); ctx.moveTo(xG,midY); ctx.lineTo(xR,midY); ctx.stroke();

    const monthsSaved = payoffRed - payoffGreen;
    ctx.fillStyle="#333"; ctx.textAlign="center"; ctx.textBaseline="bottom";
    ctx.fillText(`${monthsToYearsMonths(monthsSaved)} saved`, (xG+xR)/2, midY-4);
    tag.textContent = `Time saved: ${monthsToYearsMonths(monthsSaved)}`;
  } else { tag.textContent = ''; }
}

function setClassBySign(el, val){
  el.classList.remove("num-good","num-bad");
  if (val>0) el.classList.add("num-good");
  if (val<0) el.classList.add("num-bad");
}

// --- Main run
function run(){
  const inputs = {
    homeLoan: parseFloat($("homeLoan").value||"0"),
    homeRate: parseFloat($("homeRate").value||"0")/100,
    loanTermYears: parseInt($("loanTerm").value||"25",10),
    investRate: parseFloat($("investRate").value||"0")/100,
    equityRelease: parseFloat($("equityRelease").value||"0"),
    extraMonthly: parseFloat($("extraMonthly").value||"0"),
    offsetStart: parseFloat($("offsetStart").value||"0"),
    divDest: $("divDest").value,
    expectedReturn: parseFloat($("expectedReturn").value||"0")/100,
    divYield: parseFloat($("divYield").value||"0")/100,
    years: parseInt($("years").value||"10",10),
    taxRate: parseFloat($("taxBracket").value)+($("medicare").checked?0.02:0)
  };

  const mHome = inputs.homeRate/12;
  const mInvest = inputs.investRate/12;
  const mReturnTotal = Math.pow(1+inputs.expectedReturn,1/12)-1;
  const mDivYield = Math.pow(1+inputs.divYield,1/12)-1;
  const mGrowth = Math.max(mReturnTotal - mDivYield, 0);

  const nMonthsRemaining = inputs.loanTermYears*12;
  const baselinePmt = pmt(inputs.homeLoan, mHome, nMonthsRemaining);

  // Baseline
  const baselineSeries = seriesBaseline(inputs.homeLoan, mHome, baselinePmt);
  const baselineMonthsToZero = baselineSeries.length - 1;

  // Strategy
  let investLoan = inputs.equityRelease, portfolio = inputs.equityRelease, offset = inputs.offsetStart;
  let totalInvested = inputs.equityRelease, totalLoanInterest = 0, totalTaxShield=0, totalDivTax=0, offsetInterestSaved=0;
  let bal = inputs.homeLoan, strategySeries=[bal];
  const months = Math.min(nMonthsRemaining, inputs.years*12);

  for (let m=0; m<months && bal>0; m++){
    let payNow = baselinePmt + inputs.extraMonthly;

    if (inputs.extraMonthly>0){
      investLoan += inputs.extraMonthly;
      portfolio  += inputs.extraMonthly;
      totalInvested += inputs.extraMonthly;
    }

    const divCash = portfolio*mDivYield;
    const growth  = portfolio*mGrowth;
    const divTax  = divCash*inputs.taxRate;
    totalDivTax  += divTax;
    const divAfterTax = divCash - divTax;

    if (inputs.divDest==="repay"){ payNow += divAfterTax; }
    else if (inputs.divDest==="offset"){ offset += divAfterTax; }
    else { portfolio += divAfterTax; }

    portfolio += growth;

    const investInterest = investLoan*mInvest;
    totalLoanInterest += investInterest;
    totalTaxShield    += investInterest*inputs.taxRate;

    const effectiveBal = Math.max(bal - offset, 0);
    const interestHome = effectiveBal*mHome;
    const interestWithoutOffset = bal*mHome;
    offsetInterestSaved += Math.max(interestWithoutOffset - interestHome, 0);

    const principalPaid = Math.min(payNow - interestHome, bal);
    bal -= principalPaid;
    if (bal < 0) bal = 0;
    strategySeries.push(bal);
  }

  if (bal > 0){
    const tail = seriesBaseline(bal, mHome, baselinePmt);
    strategySeries = strategySeries.concat(tail.slice(1));
  }
  const strategyMonthsToZero = strategySeries.length - 1;

  const cumulativeNetTax = totalTaxShield - totalDivTax;
  const timeSavedMonths  = Math.max(baselineMonthsToZero - strategyMonthsToZero, 0);

  // Show results
  $("resultsCard").style.display = "block";

  $("hl_timeSaved").textContent = timeSavedMonths===0 ? "No time saved" : monthsToYearsMonths(timeSavedMonths);
  $("hl_portfolio").textContent = money(portfolio);
  $("hl_offsetSaved").textContent = money(offsetInterestSaved);

  // badges
  const b1 = $("hl_timeBadge");
  if (timeSavedMonths>0){ b1.style.display="inline-block"; b1.textContent = `+ ${monthsToYearsMonths(timeSavedMonths)}`; } else { b1.style.display="none"; }
  const b2 = $("hl_portBadge");
  b2.style.display="inline-block"; b2.textContent = `${$("years").value}y`;

  $("baselinePayoff").textContent = monthsToYearsMonths(baselineMonthsToZero);
  $("strategyPayoff").textContent = monthsToYearsMonths(strategyMonthsToZero);
  $("timeSaved").textContent = timeSavedMonths===0 ? "—" : monthsToYearsMonths(timeSavedMonths);

  $("totalInvested").textContent  = money(totalInvested);
  $("portfolioValue").textContent = money(portfolio);

  $("divTax").textContent       = money(totalDivTax);
  $("loanInterest").textContent = money(totalLoanInterest);
  $("netTaxBenefit").textContent= money(cumulativeNetTax);
  setClassBySign($("netTaxBenefit"), cumulativeNetTax);

  $("offsetFinal").textContent  = money(offset);

  const taxLine = cumulativeNetTax > 0
    ? `Your tax position improves by around ${money(cumulativeNetTax)}.`
    : cumulativeNetTax < 0
      ? `You’d pay about ${money(-cumulativeNetTax)} more in net tax.`
      : `Your net tax effect is roughly neutral.`;
  const timeLine = timeSavedMonths>0
    ? `With this setup, your home loan could be paid off about ${monthsToYearsMonths(timeSavedMonths)} sooner.`
    : `This setup doesn’t shorten the loan term unless extras/dividends go to the mortgage.`;
  $("narrative").textContent =
    `${timeLine} Your investments could grow to about ${money(portfolio)} over ${$("years").value} years. ` +
    `Your offset saves about ${money(offsetInterestSaved)} in interest. ${taxLine}`;

  // draw
  drawChart($("loanChart"), baselineSeries, strategySeries, baselineMonthsToZero, strategyMonthsToZero);
}

// Slider helpers (sync to inputs & UI preview)
function bindSlider(rangeId, inputId, viewId, isMoney=false, suffix="%"){
  const r=$(rangeId), i=$(inputId), v=$(viewId);
  const fmt = (x)=> isMoney ? money(Number(x)) : `${Number(x).toFixed(isMoney?0: (suffix==="%"?1:0))}${isMoney?"":suffix}`;
  const push = ()=>{
    i.value = isMoney ? Number(r.value) : Number(r.value);
    v.value = fmt(r.value);
  };
  const pull = ()=>{
    const raw = parseFloat(i.value||"0");
    r.value = raw;
    v.value = fmt(raw);
  };
  r.addEventListener("input", ()=>{ push(); });
  r.addEventListener("change", ()=>{ push(); $("calcBtn").click(); });
  i.addEventListener("change", ()=>{ pull(); $("calcBtn").click(); });
  // init
  pull();
}

window.addEventListener("load", ()=>{
  // Populate brackets
  const sel=$("taxBracket"); sel.innerHTML="";
  TAX_BRACKETS.forEach(b=>{ const o=document.createElement("option"); o.value=b.rate; o.textContent=b.label; sel.appendChild(o); });
  sel.value="0.30";

  // Sliders
  bindSlider("s_homeRate","homeRate","homeRate_view",false,"%");
  bindSlider("s_investRate","investRate","investRate_view",false,"%");
  bindSlider("s_expectedReturn","expectedReturn","expectedReturn_view",false,"%");
  bindSlider("s_divYield","divYield","divYield_view",false,"%");
  bindSlider("s_extraMonthly","extraMonthly","extraMonthly_view",true,"");

  $("calcBtn").addEventListener("click", run);

  // Redraw on resize if results visible
  window.addEventListener("resize", ()=>{ if ($("resultsCard").style.display!=="none") $("calcBtn").click(); });
});
</script>
</body>
</html>
