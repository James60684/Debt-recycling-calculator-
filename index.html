<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Debt Recycling Calculator (AU)</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Debt Recycling AU">
<meta name="theme-color" content="#ffffff">
<style>
:root { --gap:14px; }
*{box-sizing:border-box}
html,body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f7f9;color:#111}
header{padding:24px 18px 10px}
h1{margin:0 0 6px;font-size:22px}
.muted{color:#667;margin:0;font-size:13px}
main{padding:0 14px 40px}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:12px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
h2{font-size:16px;margin:0 0 12px}
.row{display:flex;gap:var(--gap);align-items:center;justify-content:space-between;margin:10px 0}
.row input,.row select{width:48%;padding:10px 12px;border:1px solid #d8dde6;border-radius:10px;font-size:16px;background:#fbfcfe}
.switch{gap:10px;justify-content:flex-start}
.note{color:#667;font-size:12px;margin-top:6px}
button{width:100%;padding:12px;font-size:16px;border:none;border-radius:10px;background:#1f6feb;color:#fff}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.small{font-size:12px;color:#667}
.kv{display:flex;justify-content:space-between;align-items:baseline;margin:8px 0}
.kv strong{font-variant-numeric:tabular-nums}
hr{border:0;border-top:1px dashed #e3e6eb;margin:10px 0}
.badge{display:inline-block;padding:2px 8px;border-radius:100px;background:#eef2ff;color:#334;font-size:12px}
.fine{color:#667;font-size:12px;margin-top:6px}

/* New: simplified results styling */
.headlines{display:grid;grid-template-columns:1fr;gap:10px;margin-top:4px}
@media (min-width:560px){ .headlines{grid-template-columns:1fr 1fr 1fr} }
.headline{background:#f0f7ff;border:1px solid #e1efff;border-radius:12px;padding:12px}
.headline h3{margin:0 0 4px;font-size:14px;color:#234}
.big{font-size:20px;font-weight:700;line-height:1.2}
.good{color:#0a7a28}
.bad{color:#b00020}
.sectionTitle{margin:8px 0 6px;font-weight:700;font-size:14px;color:#345}
.dim{color:#667}
</style>
</head>
<body>
<header>
  <h1>Debt Recycling (AU)</h1>
  <p class="muted">Simple model • Not financial advice</p>
</header>

<main>
  <section class="card">
    <h2>Your marginal tax rate</h2>
    <label class="row">
      <span>Australian resident tax brackets (2025–26)</span>
      <select id="taxBracket"></select>
    </label>
    <label class="row switch">
      <input type="checkbox" id="medicare" checked />
      <span>Include Medicare levy (2%)</span>
    </label>
    <p class="note">Brackets exclude the Medicare levy.</p>
  </section>

  <section class="card">
    <h2>Home loan & strategy</h2>
    <div class="grid">
      <label><span class="small">Home loan balance</span><input id="homeLoan" type="number" inputmode="decimal" value="600000"></label>
      <label><span class="small">Home loan rate (%)</span><input id="homeRate" type="number" inputmode="decimal" value="6.5"></label>
      <label><span class="small">Remaining loan term (years)</span><input id="loanTerm" type="number" inputmode="numeric" value="25"></label>
      <label><span class="small">Investment loan rate (%)</span><input id="investRate" type="number" inputmode="decimal" value="6.5"></label>
      <label><span class="small">Initial equity released (A$)</span><input id="equityRelease" type="number" inputmode="decimal" value="0"></label>
      <label><span class="small">Extra repayment (monthly)</span><input id="extraMonthly" type="number" inputmode="decimal" value="1000"></label>
      <label><span class="small">Offset balance (A$)</span><input id="offsetStart" type="number" inputmode="decimal" value="0"></label>
      <label><span class="small">Dividends destination</span>
        <select id="divDest">
          <option value="repay">Extra repayment</option>
          <option value="offset">Offset account</option>
          <option value="reinvest">Reinvest</option>
        </select>
      </label>
    </div>
  </section>

  <section class="card">
    <h2>Investments</h2>
    <div class="grid">
      <label><span class="small">Expected total return p.a. (%)</span><input id="expectedReturn" type="number" inputmode="decimal" value="7"></label>
      <label><span class="small">Dividend yield p.a. (%)</span><input id="divYield" type="number" inputmode="decimal" value="4"></label>
      <label><span class="small">Horizon (years)</span><input id="years" type="number" inputmode="numeric" value="10" min="1" max="40"></label>
    </div>
    <p class="note">Dividends are taxable cash; growth is unrealised (no CGT until sale). Offset reduces interest by the offset balance but doesn’t reduce principal.</p>
    <button id="calcBtn">Calculate</button>
  </section>

  <!-- New simplified results -->
  <section class="card" id="resultsCard" style="display:none">
    <h2>What this means for you</h2>
    <div class="headlines">
      <div class="headline">
        <h3>Loan paid off faster</h3>
        <div class="big" id="hl_timeSaved">—</div>
        <div class="dim">Strategy vs doing nothing extra</div>
      </div>
      <div class="headline">
        <h3>Investments could grow to</h3>
        <div class="big good" id="hl_portfolio">—</div>
        <div class="dim">After dividend tax (growth reinvested)</div>
      </div>
      <div class="headline">
        <h3>Interest saved via offset</h3>
        <div class="big good" id="hl_offsetSaved">—</div>
        <div class="dim">From your offset balance</div>
      </div>
    </div>

    <div class="sectionTitle">Loan impact</div>
    <div class="kv"><span>Home loan paid off (no strategy)</span><strong id="baselinePayoff">—</strong></div>
    <div class="kv"><span>Home loan paid off (with strategy)</span><strong id="strategyPayoff">—</strong></div>
    <div class="kv"><span>Time saved on the loan</span><strong id="timeSaved">—</strong></div>

    <hr>
    <div class="sectionTitle">Investment growth</div>
    <div class="kv"><span>How much you’ve put in (equity + recycling)</span><strong id="totalInvested">—</strong></div>
    <div class="kv"><span>What your investments could grow to</span><strong id="portfolioValue">—</strong></div>

    <hr>
    <div class="sectionTitle">Tax impact</div>
    <div class="kv"><span>Tax you’ll pay on dividends</span><strong id="divTax">—</strong></div>
    <div class="kv"><span>Interest you can claim as a deduction</span><strong id="loanInterest">—</strong></div>
    <div class="kv"><span><span class="badge">Net impact of tax</span> (savings − dividend tax)</span><strong id="netTaxBenefit">—</strong></div>

    <hr>
    <div class="kv"><span>Final offset balance</span><strong id="offsetFinal">—</strong></div>

    <p class="fine" id="narrative">—</p>
  </section>
</main>

<script>
// AU resident tax brackets 2025–26 (excl. Medicare levy)
const TAX_BRACKETS = [
  { label: "0 – $18,200 (0%)", rate: 0.00 },
  { label: "$18,201 – $45,000 (16%)", rate: 0.16 },
  { label: "$45,001 – $135,000 (30%)", rate: 0.30 },
  { label: "$135,001 – $190,000 (37%)", rate: 0.37 },
  { label: "$190,001+ (45%)", rate: 0.45 }
];

function $(id){ return document.getElementById(id); }
function money(x){ return x.toLocaleString("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}); }
function monthsToYearsMonths(m){ const y=Math.floor(m/12), mo=m%12; return `${y}y ${mo}m`; }
function pmt(P,r,n){ if(r===0) return P/n; return P*r/(1-Math.pow(1+r,-n)); }
function payoffMonths(principal, mRate, standardPmt){
  let bal=principal, m=0;
  while(bal>0 && m<2000*12){
    const i=bal*mRate;
    const pay=Math.min(standardPmt, bal+i);
    bal -= (pay - i);
    m++;
  }
  return m;
}
function populateBrackets(){
  const sel=$("taxBracket");
  TAX_BRACKETS.forEach(b=>{
    const o=document.createElement("option");
    o.value=b.rate.toString();
    o.textContent=b.label;
    sel.appendChild(o);
  });
  sel.value="0.30";
}

function setClassBySign(el, value){
  el.classList.remove("good","bad");
  if (value > 0) el.classList.add("good");
  if (value < 0) el.classList.add("bad");
}

function run(){
  const inputs = {
    homeLoan: parseFloat($("homeLoan").value||"0"),
    homeRate: parseFloat($("homeRate").value||"0")/100,
    loanTermYears: parseInt($("loanTerm").value||"25",10),
    investRate: parseFloat($("investRate").value||"0")/100,
    equityRelease: parseFloat($("equityRelease").value||"0"),
    extraMonthly: parseFloat($("extraMonthly").value||"0"),
    offsetStart: parseFloat($("offsetStart").value||"0"),
    divDest: $("divDest").value, // repay | offset | reinvest
    expectedReturn: parseFloat($("expectedReturn").value||"0")/100,
    divYield: parseFloat($("divYield").value||"0")/100,
    years: parseInt($("years").value||"10",10),
    taxRate: parseFloat($("taxBracket").value)+($("medicare").checked?0.02:0)
  };

  const mHome = inputs.homeRate/12;
  const mInvest = inputs.investRate/12;
  const mReturnTotal = Math.pow(1+inputs.expectedReturn,1/12)-1;
  const mDivYield = Math.pow(1+inputs.divYield,1/12)-1;
  const mGrowth = Math.max(mReturnTotal - mDivYield, 0);

  const nMonthsRemaining = inputs.loanTermYears*12;
  const baselinePmt = pmt(inputs.homeLoan, mHome, nMonthsRemaining);

  // Strategy simulation
  let investLoan = 0, portfolio = 0, offset = inputs.offsetStart;
  investLoan += inputs.equityRelease;
  portfolio  += inputs.equityRelease;

  let totalInvested = inputs.equityRelease;
  let totalLoanInterest = 0;
  let totalTaxShield = 0;
  let totalDivTax = 0;
  let offsetInterestSaved = 0;

  let bal = inputs.homeLoan;
  const months = Math.min(nMonthsRemaining, inputs.years*12);

  for (let m=0; m<months && bal>0; m++){
    let payNow = baselinePmt + inputs.extraMonthly;

    if (inputs.extraMonthly>0){
      investLoan += inputs.extraMonthly;
      portfolio  += inputs.extraMonthly;
      totalInvested += inputs.extraMonthly;
    }

    const divCash = portfolio*mDivYield;
    const growth  = portfolio*mGrowth;
    const divTax  = divCash*inputs.taxRate;
    totalDivTax  += divTax;
    const divAfterTax = divCash - divTax;

    if (inputs.divDest==="repay"){ payNow += divAfterTax; }
    else if (inputs.divDest==="offset"){ offset += divAfterTax; }
    else { portfolio += divAfterTax; }

    portfolio += growth;

    const investInterest = investLoan*mInvest;
    totalLoanInterest += investInterest;
    totalTaxShield    += investInterest*inputs.taxRate;

    const effectiveBal = Math.max(bal - offset, 0);
    const interestHome = effectiveBal*mHome;
    const interestWithoutOffset = bal*mHome;
    offsetInterestSaved += Math.max(interestWithoutOffset - interestHome, 0);

    const principalPaid = Math.min(payNow - interestHome, bal);
    bal -= principalPaid;
    if (bal < 0) bal = 0;
  }

  const remainingMonthsAfterHorizon = payoffMonths(bal, mHome, baselinePmt);
  const strategyMonthsToZero = (bal===0 ? Math.min(nMonthsRemaining, inputs.years*12)
                                        : inputs.years*12 + remainingMonthsAfterHorizon);
  const baselineMonthsToZero = payoffMonths(inputs.homeLoan, mHome, baselinePmt);

  const cumulativeNetTax = totalTaxShield - totalDivTax;
  const timeSavedMonths = Math.max(baselineMonthsToZero - strategyMonthsToZero, 0);

  // Show results card
  $("resultsCard").style.display = "block";

  // Headline cards
  $("hl_timeSaved").textContent = timeSavedMonths===0 ? "No time saved" : monthsToYearsMonths(timeSavedMonths);
  $("hl_portfolio").textContent = money(portfolio);
  $("hl_offsetSaved").textContent = money(offsetInterestSaved);
  setClassBySign($("hl_offsetSaved"), offsetInterestSaved);

  // Groups
  $("baselinePayoff").textContent = monthsToYearsMonths(baselineMonthsToZero);
  $("strategyPayoff").textContent = monthsToYearsMonths(strategyMonthsToZero);
  $("timeSaved").textContent = timeSavedMonths===0 ? "—" : monthsToYearsMonths(timeSavedMonths);

  $("totalInvested").textContent  = money(totalInvested);
  $("portfolioValue").textContent = money(portfolio);

  $("divTax").textContent       = money(totalDivTax);
  $("loanInterest").textContent = money(totalLoanInterest);
  $("netTaxBenefit").textContent = money(cumulativeNetTax);
  setClassBySign($("netTaxBenefit"), cumulativeNetTax);

  $("offsetFinal").textContent  = money(offset);

  // Narrative paragraph
  const taxLine = cumulativeNetTax > 0
    ? `Your tax position improves by around ${money(cumulativeNetTax)} (deductions outweigh dividend tax).`
    : cumulativeNetTax < 0
      ? `You’d pay about ${money(-cumulativeNetTax)} more in net tax (dividend tax outweighs deductions).`
      : `Your net tax effect is roughly neutral.`;

  const timeLine = timeSavedMonths>0
    ? `With this setup, your home loan could be paid off about ${monthsToYearsMonths(timeSavedMonths)} sooner.`
    : `This setup doesn’t shorten the loan term unless you direct more cash (extras/dividends) to the mortgage.`;

  $("narrative").textContent =
    `${timeLine} Your investments could grow to about ${money(portfolio)} over ${$("years").value} years. ${taxLine} ` +
    `Your offset account saves approximately ${money(offsetInterestSaved)} in interest.`;
}

window.addEventListener("load", ()=>{
  // Brackets dropdown
  const sel=$("taxBracket");
  TAX_BRACKETS.forEach(b=>{ const o=document.createElement("option"); o.value=b.rate; o.textContent=b.label; sel.appendChild(o); });
  sel.value="0.30";
  $("calcBtn").addEventListener("click", run);
});
</script>
</body>
</html>
